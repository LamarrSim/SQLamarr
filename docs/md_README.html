<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SQLamarr: SQLamarr</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SQLamarr
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SQLamarr </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md1"></a>
The stand-alone ultra-fast simulation option for LHCb</h2>
<p>The detailed simulation of the hadron collisions at the LHC, and of the interaction of the generated particles with the detector material dominates the cost for the computing infrastructure pledged to the LHCb Collaboration.</p>
<p>Among the various options explored towards a faster simulation, there is <a class="el" href="namespaceLamarr.html" title="A test class.">Lamarr</a>, a framework defining a pipeline of parametrizations transforming generator-level quantities to reconstructed, analysis-level features. Most of the parametrizations are defined using <em>machine-learning</em>, and in particular Deep Neural Networks and Gradient Boosted Decision Trees, with a traing procedure defined in independent packages (<em>e.g.</em> <a href="https://github.com/landerlini/lb-trksim-train">landerlini/lb-trksim-train</a> and <a href="https://github.com/mbarbetti/lb-pidsim-train">mbarbetti/lb-pidsim-train</a>).</p>
<p>To be integrated in the LHCb software stack, models must be queried from a C++ application, running in the Gaudi framework, which includes a dedicated multithreading scheduler which was found to conflict with the schedulers of TensorFlow and ONNX runtimes. In addition, since the models are relatively simple and fast to evaluate, the overhead of context switching from Gaudi to a dedicated runtime was observed to be unaccptably large. Hence, models are converted into compatible C code using the <a href="https://github.com/landerlini/scikinC">landerlini/scikinC</a> package and distributed through the CernVM FileSystem releasing the <a href="https://gitlab.cern.ch/lhcb-datapkg/LamarrData">LamarrData package</a>.</p>
<p>While crucial to the applications within LHCb, the integration with Gaudi and <a href="https://gitlab.cern.ch/lhcb/Gauss">Gauss</a> makes the adoption of <a class="el" href="namespaceLamarr.html" title="A test class.">Lamarr</a> unappealing for researchers outside of the LHCb community approaching the LHCb simulation to evaluate the experiment sensitivity to new physics phenomena or studying the recently-released LHCb Open Data. The <a href="https://github.com/landerlini/SQLamarr">landerlini/SQLamarr</a> package aims at decoupling <a class="el" href="namespaceLamarr.html" title="A test class.">Lamarr</a> from Gaudi providing a stand-alone application with minimal dependencies that can be easily set up and run in any Linux machine. The parametrizations are shared between the Gauss-embedded implementation <a href="https://gitlab.cern.ch/lhcb/Gauss/-/tree/master/Sim/LbLamarr">LbLamarr</a> and <code>SQLamarr</code>. In the future, the exact same package might be integrated within Gaudi to reduce the maintainance effort.</p>
<p>To replace the ROOT-based TransientEventStore concept defind in Gaudi, <code>SQLamarr</code> adopts the SQLite3 package, enabling vectorized processing of batches of events, for a better performance.</p>
<p>To avoid dependencies on ROOT, also the persistency is handled using SQLite3, writing the reconstructed (or intermediate) quantities in the form of SQLite3 databases. Note that converting an SQLite3 table to a ROOT nTuple requires no more than 3 lines of Python: </p><div class="fragment"><div class="line">import sqlite3, uproot, pandas</div>
<div class="line">with sqlite3.connect(&quot;SomeInput.db&quot;) as conn:</div>
<div class="line">  uproot.open(&quot;SomeFile.root&quot;, &quot;RECREATE&quot;)[&quot;myTree&quot;] = pandas.read_sql_table(&quot;myTable&quot;, conn)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Dependencies</h1>
<ul>
<li><a href="https://www.sqlite.org/index.html">SQLite3</a> with C/C++ headers</li>
<li><a href="http://hepmc.web.cern.ch/hepmc/">HepMC3</a> as a standard interface to event generators.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
How to use SQLamarr</h1>
<p>The project is not mature enough to provide a good user experience. For the time being, clone the repository and compile the package with CMake, then edit the file <code><a class="el" href="main_8cpp.html">src/main.cpp</a></code> to define the desired pipeline, by using the building blocks provided by the package.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Copyright and Licence</h1>
<p>(c) Copyright 2022 CERN for the benefit of the LHCb Collaboration.</p>
<p>This software is distributed under the terms of the GNU General Public Licence version 3 (GPL Version 3), copied verbatim in the file "LICENCE".</p>
<p>In applying this licence, CERN does not waive the privileges and immunities granted to it by virtue of its status as an Intergovernmental Organization <br  />
 or submit itself to any jurisdiction. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
